var gmap=null;var overlay;var MY_MAPTYPE_ID="gray";var bounds;var dialog;var markersArray=[];var lastID=null;var dataAll;var Itinerary;var directionDisplay;var directionsService=new google.maps.DirectionsService();var directionsService;var origin=null;var destination=null;var waypoints=[];var markers=[];var directionsVisible=false;var imageRed=new google.maps.MarkerImage("images/mapIcons/red.png",new google.maps.Size(12,20),new google.maps.Point(0,0),new google.maps.Point(0,20));var imageYellow=new google.maps.MarkerImage("images/mapIcons/yellow.png",new google.maps.Size(12,20),new google.maps.Point(0,0),new google.maps.Point(0,20));var imageGreen=new google.maps.MarkerImage("images/mapIcons/green.png",new google.maps.Size(12,20),new google.maps.Point(0,0),new google.maps.Point(0,20));var shadow=new google.maps.MarkerImage("images/mapIcons/mm_20_shadow.png",new google.maps.Size(22,20),new google.maps.Point(0,0),new google.maps.Point(0,20));var shape={coord:[1,1,1,20,18,20,18,1],type:"poly"};var imageOver=new google.maps.MarkerImage("images/mapIcons/highlight.png",new google.maps.Size(12,20),new google.maps.Point(0,0),new google.maps.Point(0,20));var myMarker=false;function initialize(){var _1=new dijit.form.Button({label:"Reset",title:"Reset search criteria",type:"reset",onClick:function(){clearSearchBox();queryData(1);}},"buttonReset");var _1=new dijit.form.Button({label:"Get Directions!",onClick:function(){reset();calcRoute();}},"buttonDirections");var _1=new dijit.form.Button({label:"Reset",onClick:function(){reset();destroyAll();}},"buttonRemove");var _1=new dijit.form.Button({label:"Delete selected Site(s)",onClick:function(){deleteSelected();}},"buttonDelete");var _2=new google.maps.LatLng(47.250138520439556,-122.47643585205077);var _3=[{featureType:"administrative",elementType:"all",stylers:[{saturation:-100}]},{featureType:"landscape",elementType:"all",stylers:[{saturation:-100}]},{featureType:"poi",elementType:"all",stylers:[{saturation:-100}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100}]},{featureType:"transit",elementType:"all",stylers:[{saturation:-100}]},{featureType:"water",elementType:"all",stylers:[{saturation:-100}]}];var _4={zoom:12,center:_2,panControl:false,zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_TOP},mapTypeControl:true,mapTypeControlOptions:{mapTypeIds:[MY_MAPTYPE_ID,google.maps.MapTypeId.HYBRID]},scaleControl:true,streetViewControl:true,overviewMapControl:false,mapTypeId:MY_MAPTYPE_ID};gmap=new google.maps.Map(document.getElementById("map_canvas"),_4);var _5={name:"Map",alt:"Show standard map"};var _6=new google.maps.StyledMapType(_3,_5);gmap.mapTypes.set(MY_MAPTYPE_ID,_6);var _7=document.createElement("DIV");_7.style.padding="5px 5px 5px 5px";var _8=document.createElement("DIV");_8.style.backgroundColor="#77C9B2";_8.style.borderStyle="solid";_8.style.borderWidth="2px";_8.style.borderColor="#b2b2b2";var _9=document.createElement("img");_9.src="images/legend.jpg";_9.style.width="69px";_9.style.height="39px";_8.appendChild(_9);_7.appendChild(_8);gmap.controls[google.maps.ControlPosition.LEFT_TOP].push(_7);overlay=new google.maps.OverlayView();overlay.draw=function(){};overlay.setMap(gmap);var _a="<div><b>Create your own itinerary:</b>";_a+="<ul><li>Enter Starting Point information</li>";_a+="<li>Click map marker</li>";_a+="<li>Select <i>Add to my Itinerary</i> <br>(up to 9 sites)</li>";_a+="</ul></div>";_a+="<div style='border-top:1px solid #C0C0C0;background:#EEEEEE;padding:4px 4px 4px 4px;'>";_a+="<b>Starting Point:</b>";_a+="</div>";_a+="<div style='float:right;'>Address: <input type='text' name='StartAddress1' id='StartAddress1' value='747 Market St' /></div>";_a+="<div style='float:right;'>City: <input type='text' name='StartAddress2' id='StartAddress2' value='Tacoma' /><br />&nbsp;</div>";_a+="<div style='clear:both;background:#EEEEEE;padding:4px 4px 4px 4px;'><b>Itinerary: </b></div>";_a+="<div class='Itinerary Container' style='clear:both;width:230px;'><ol id='Itinerary Node' class='container'></ol></div>";dojo.byId("theItinerary1").innerHTML=_a;dojo.byId("theItinerary2").innerHTML="<i>No Sites selected.</i>";dojo.byId("directions1").innerHTML="<a href='javascript:PrintContent();'>Print Directions</a>";dojo.byId("directions2").innerHTML="<a href=\"javascript:togglePane('rightPane','rightTabs','ItineraryTab');\">Modify Itinerary</a>";var _b="<div style='float:left;color:rgb(0,0,0); font-weight:bold;'>Tacoma-Pierce County Public Art Tour</div>";_b+="<div style=\"float:right;\"><input type=\"text\"  title='Search for title or artist by keyword' name='theKeywords' id='theKeywords' value=' Search by title or artist...' onmouseover=\"if (this.value==' Search by title or artist...') this.value = ''\" onmouseout=\"if (this.value=='')this.value=' Search by title or artist...';\" onkeypress=\"if(event.keyCode==13) {newKeyQuery();}\" style=\"background: white url(images/search.png) right no-repeat;padding-right: 17px;\"/></div>";_b+="<div style='float:right;'><a href='#' onclick=\"javascript:dijit.byId('mapWelcome').show();\" style='color:#EEEEEE; font-weight:bold;'>Welcome - Contact Us</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div>";dojo.byId("headerContent").innerHTML=_b;Itinerary=new dojo.dnd.Source("Itinerary Node");Itinerary.insertNodes(false,[]);dojo.dnd.Avatar.prototype._generateText=function(){return (this.manager.copy?"copy":"Move to here");};directionsDisplay=new google.maps.DirectionsRenderer();directionsDisplay.setMap(gmap);directionsDisplay.setPanel(document.getElementById("directionsPanel"));bounds=new google.maps.LatLngBounds();};function addMarker(_c,_d,_e,_f,_10,_11,ID){var _12=new google.maps.LatLng(_c,_d);var _13=new google.maps.Marker({position:_12,id:ID,shadow:shadow,icon:_11,shape:shape,optimized:false,map:gmap});google.maps.event.addListener(_13,"mouseover",function(){_13.setIcon(imageOver);var evt=_13.getPosition();var _14=overlay.getProjection().fromLatLngToContainerPixel(evt);closeDialog();var _15=new dijit.TooltipDialog({id:"tooltipDialog",content:_e,style:"position: absolute;z-index:100"});_15.startup();dojo.style(_15.domNode,"opacity",0.85);dijit.placeOnScreen(_15.domNode,{x:_14.x,y:_14.y},["BL","TL","BR","TR"],{x:25,y:15});});google.maps.event.addListener(_13,"mouseout",function(){_13.setIcon(_11);closeDialog();});google.maps.event.addListener(_13,"click",function(){myDialog(_f,_10);});markersArray.push(_13);};function closeDialog(){var _16=dijit.byId("tooltipDialog");if(_16){_16.destroy();}};function myDialog(_17,_18){myDlg=new dijit.Dialog({draggable:false});myDlg.titleNode.innerHTML=_18;myDlg.attr("content",_17);myDlg.show();dojo.connect(dijit._underlay,"onClick",function(e){myDlg.destroy();});};function myLightbox(url,_19){dialog.show({href:url,title:_19});};function calcRoute(){directionsDisplay.setPanel(document.getElementById("directionsPanel"));origin=dojo.byId("StartAddress1").value+","+dojo.byId("StartAddress2").value;var _1a=dojo.byId("Itinerary Node"),_1b=_1a.getElementsByTagName("li");for(i=0;i<_1b.length;i++){destination=_1b[i].innerHTML+",WA";if(i+1!=_1b.length){waypoints.push({location:destination,stopover:true});}}var _1c=google.maps.DirectionsTravelMode.DRIVING;var _1d={origin:origin,destination:destination,waypoints:waypoints,travelMode:_1c,optimizeWaypoints:document.getElementById("optimize").checked};if(_1b.length==0){alert("No Sites in Itinerary.");}else{if(dojo.byId("StartAddress1").value==""){alert("Please enter a Starting Point Address.");}else{directionsService.route(_1d,function(_1e,_1f){if(_1f==google.maps.DirectionsStatus.OK){directionsDisplay.setDirections(_1e);togglePane("rightPane","rightTabs","DirectionsTab");}});clearMarkers();directionsVisible=true;}}};function clearMarkers(){for(var i=0;i<markers.length;i++){markers[i].setMap(null);}};function clearWaypoints(){markers=[];origin=null;destination=null;waypoints=[];directionsVisible=false;};function reset(){clearMarkers();clearWaypoints();directionsDisplay.setMap(null);directionsDisplay.setPanel(null);directionsDisplay=new google.maps.DirectionsRenderer();directionsDisplay.setMap(gmap);directionsDisplay.setPanel(document.getElementById("theDirections"));};function clearSearchBox(){document.getElementById("theKeywords").value=" Search by title or artist...";};function togglePane(_20,tab,_21){if(!(dijit.byId(_20)._showing)){dijit.byId(tab).selectChild(_21);}else{if(dijit.byId(tab).selectedChildWidget.id!=_21){dijit.byId(tab).selectChild(_21);}else{dijit.byId(_20).toggle();}}};function destroyAll(){dojo.empty("Itinerary Node");dojo.byId("theItinerary2").style.display="block";dojo.byId("theItinerary3").style.display="none";dojo.byId("theItinerary4").style.display="none";};function addStudio(_22){var _23="No";var _24=dojo.byId("Itinerary Node"),_25=_24.getElementsByTagName("li");if(_25.length==9){alert("Itinerary limited to 9 Sites.  Please remove a Site from Itinerary before adding additional Sites.");}else{for(i=0;i<_25.length;i++){if(_25[i].innerHTML==_22){_23="Yes";}}if(_23=="No"){Itinerary.insertNodes(false,[_22]);}}if(dojo.byId("theItinerary2").style.display="block"){dojo.byId("theItinerary2").style.display="none";dojo.byId("theItinerary3").style.display="block";dojo.byId("theItinerary4").style.display="block";}};function deleteSelected(){Itinerary.deleteSelectedNodes();};function PrintContent(){var _26=document.getElementById("directionsPanel");var _27=window.open("","PrintWindow","width=750,height=650,top=50,left=50,toolbars=no,scrollbars=yes,status=no,resizable=yes");_27.document.writeln(_26.innerHTML);_27.document.close();_27.focus();_27.print();};function queryData(_28){cleanMap();bounds=new google.maps.LatLngBounds();if(_28==1){newQuery(1);}else{newQuery();}};function cleanMap(){if(markersArray){for(i in markersArray){markersArray[i].setMap(null);}markersArray=[];}};function getJson(){dojo.xhrGet({url:"PubArt.txt",handleAs:"json",preventCache:true,load:load_handler,error:error_handler});};function load_handler(_29){dataAll=_29;var _2a=dojox.json.query("$.items[/Title]",dataAll);addMarkers(_2a);};function error_handler(_2b){alert("--- Error occurred. ---\n "+error.message);};function newQuery(_2c){closeDialog();var _2d="$.items[";if(_2c!=1){if(dijit.byId("Category").value!="All"){if(dijit.byId("Category").value=="Mural"){_2d+="?Category ='"+dijit.byId("Category").value+"' ";}else{if(dijit.byId("Category").value=="Sculpture"){_2d+="?Category ='Sculpture*' ";}else{_2d+="?Category !='Mural' & Category !='Sculpture: Outdoor' & Category !='Sculpture, Outdoor' & Category !='Sculpture, Indoor' & Category !='Sculpture' & Category !='Sculpture Indoor' & Category !='Sculpture: Indoor' ";}}}if(dijit.byId("Location").value!="All"){if(_2d.length>8){_2d+=" & Neighborhood ='"+dijit.byId("Location").value+"' ";}else{_2d+="?Neighborhood ='"+dijit.byId("Location").value+"' ";}}if(dijit.byId("Artist").value!="All"){if(_2d.length>8){_2d+=" & Artist ='"+dijit.byId("Artist").value+"' ";}else{_2d+="?Artist ='"+dijit.byId("Artist").value+"' ";}}}if(_2d.length==8){_2d="$.items[/Title]";}else{_2d+="][/Title]";}var _2e=dojox.json.query(_2d,dataAll);if(_2e.length==0){alert("Sorry, no art found. Please modify search.");var _2f="<i>No artwork found</i>";dojo.byId("searchResults").innerHTML="";}else{if(_2e.length==1){var _2f="<i>One artwork found</i>";}else{var _2f="<i>"+_2e.length+" artworks found</i>";}addMarkers(_2e);}dojo.byId("artCount").innerHTML=_2f;};function newKeyQuery(){cleanMap();bounds=new google.maps.LatLngBounds();closeDialog();var _30="*"+document.getElementById("theKeywords").value+"*";var _31=_30.replace("'","\\'");var _32="$.items[?Artist~'"+_31+"' || Title~'"+_31+"'][/Title]";var _33=dojox.json.query(_32,dataAll);if(_33.length==0){alert("Sorry, no art found. Please modify search.");var _34="<i>No artwork found</i>";dojo.byId("searchResults").innerHTML="";}else{if(_33.length==1){var _34="<i>One artwork found</i>";}else{var _34="<i>"+_33.length+" artworks found</i><br> for keyword = "+document.getElementById("theKeywords").value;}addMarkers(_33);}dojo.byId("artCount").innerHTML=_34;};function addMarkers(_35){var _36=0;var _37="";var _38="";var _39="";for(var i=0;i<_35.length;i++){if(_35[i].Lat!=null){_37="";_38="";_37+="<div style='color:rgb(56,64,142); font-weight:bold; font-style:italic; text-align:center; '>"+_35[i].Title+"</div>";_37+="<div style=\"text-align:center;\"><b>"+_35[i].Artist+"</b>";var _3a="images/artwork/"+_35[i].Image.substring(_35[i].Image.lastIndexOf("\\"),_35[i].Image.lastIndexOf("#")).replace("\\","");var _3b=_3a.replace(".JPG","1.JPG").replace(".jpg","1.jpg");_37+="<br><a href=\"javascript:myLightbox('"+_3a+"','"+_35[i].Artist.replace(/'/g,"\\'")+": <i>"+_35[i].Title.replace(/'/g,"\\'")+"</i>')\"><img src=\""+_3b+"\" style=\"max-width:100px;max-height:100px;margin:2px 5px 5px 0px;border:solid 1px #999;padding:2px\"  title='Click to enlarge photo'/></a>";_37+="<br><i>Click marker for details</i></div>";var _3c="<span style='color:rgb(56,64,142);'>"+_35[i].Title+"</span>";_38+="<div style='clear:both;width: 475px;'>";var _3d=_35[i].Location1+", "+_35[i].City;_38+="<div style='clear:both;'>";_38+="<span style='color:rgb(56,64,142);'>"+_3d+"</span>";_38+="&nbsp;|&nbsp;<a href=\"https://maps.google.com/maps?daddr="+_3d+", WA\" target='_blank'>Get Directions</a>";_38+="&nbsp;|&nbsp;<a href=\"https://maps.google.com/?cbll="+_35[i].Lat+","+_35[i].Long+"&cbp=13,0,,,&layer=c&z=17\" target='_blank'>Street View</a><br>";var _3e=_3d;_38+="<span style=clear:both;float:right;'><b>Add to my Itinerary?</b> <input type='radio' name='Itinerary' id='y' onclick='addStudio(\""+_3e+"\");togglePane(\"rightPane\",\"rightTabs\",\"ItineraryTab\");'/>Yes</span><br>";_38+="</div>";_38+="<div style='clear:both;'><hr color='#ACB1DB'></div>";_38+="<div style='clear:both;float:left;width:200px;'>";_38+="<a href=\"javascript:myLightbox('"+_3a+"','"+_35[i].Artist.replace(/'/g,"\\'")+": <i>"+_35[i].Title+"</i>')\"><img style ='float:left;margin:2px 5px 5px 5px;border:solid 1px #999;padding:2px' src='"+_3b+"' title='Click to enlarge photo' max-height='100px' max-width='100px'></a>";_38+="</div>";_38+="<div style='float:right; width:275px;'>";_38+="<b>"+_35[i].Artist;_38+="</b><br>";_38+="<span style='color:rgb(56,64,142);'><I>Category: </span>"+_35[i].Category+"</I><br>";if(_35[i].Medium!=""){_38+="<span style='color:rgb(56,64,142);'><I>Medium: </span>"+_35[i].Medium+"</I><br>";}if(_35[i].Dimensions!=""){_38+="<span style='color:rgb(56,64,142);'><I>Dimensions: </span>"+_35[i].Dimensions+"</I><br>";}if(_35[i].Year!=""){_38+="<span style='color:rgb(56,64,142);'><I>Year Created: </span>"+_35[i].Year+"</I><br>";}if(_35[i].Location2!=""){_38+="<span style='color:rgb(56,64,142);'><I>Location: </span>"+_35[i].Location2+"</I><br>";}if(_35[i].Agency!=""){_38+="<span style='color:rgb(56,64,142);'><I>Agency: </span>"+_35[i].Agency+"</I><br>";}_38+="<p>"+_35[i].Description+"</p>";_38+="</div>";_38+="</div>";var _3f=imageGreen;if(_35[i].Category.substr(0,9)=="Sculpture"){_3f=imageRed;}else{if(_35[i].Category=="Mural"){_3f=imageYellow;}}addMarker(_35[i].Lat,_35[i].Long,_37,_38,_3c,_3f);_39+=_37.replace("Click marker for details","");_39+="<center><a title='Zoom map to artwork and highlight' href='javascript:go2art("+_35[i].Lat+", "+_35[i].Long+","+_36+")'><img src='images/zoom.png' border='0' style='margin: 0px 4px'><b>Map</b></a>  |";_39+="<a title='Complete artwork details' href='javascript:myBlur();closeDialog();google.maps.event.trigger(markersArray["+_36+"],\"click\")'><img src='images/info.png' border='0' style='margin: 0px 4px'><b>Details</b></a>  |";_39+="<a title='Printable artwork summary' href='javascript:printPage("+_35[i].ID+")'><img src='images/print.gif' border='0' style='margin: 0px 4px'><b>Print</b></a>  |";_39+="<a title='Back to top of page' href='#dataQuery'><img src='images/up.png' border='0' style='margin: 0px 4px'></a></center>";_39+="<div style='clear:both;'><hr color='#ACB1DB'></div>";bounds.extend(new google.maps.LatLng(_35[i].Lat,_35[i].Long));if((i+1)==_35.length){gmap.fitBounds(bounds);if(gmap.getZoom()>17){gmap.setZoom(17);gmap.setCenter(bounds.getCenter());}}}_36=_36+1;}dojo.byId("searchResults").innerHTML=_39;};function myBlur(){document.getElementById("theKeywords").focus();};function go2art(lat,lon,id){if(lastID!=null){google.maps.event.trigger(markersArray[lastID],"mouseout");}var _40=new google.maps.LatLngBounds();var _41=new google.maps.LatLng(lat,lon);_40.extend(_41);gmap.setZoom(17);gmap.setCenter(_40.getCenter());google.maps.event.trigger(markersArray[id],"mouseover");lastID=id;};function printPage(id){var _42=dojox.json.query("$.items[?ID="+id+"][/Title]",dataAll);var _43="images/artwork/"+_42[0].Image.substring(_42[0].Image.lastIndexOf("\\"),_42[0].Image.lastIndexOf("#")).replace("\\","");var _44=_43.replace(".JPG","1.JPG").replace(".jpg","1.jpg");var _45="<div style='width: 500px;text-align:center;'><b>"+_42[0].Title+"</b></div>";_45+="<div style='width: 500px;color:rgb(56,64,142);text-align:center;'>"+_42[0].Location1+", "+_42[0].City+"</div>";_45+="<div style='clear:both;width: 500px;'><hr color='#ACB1DB'></div>";_45+="<div style='clear:both;float:left;width:200px;'>";_45+="<img style ='float:left;margin:2px 5px 5px 5px;border:solid 1px #999;padding:2px' src='"+_44+"' max-height='100px' max-width='100px'>";_45+="</div>";_45+="<div style='float:right; width:275px;'>";_45+="<b>"+_42[0].Artist;_45+="</b><br>";_45+="<span style='color:rgb(56,64,142);'><I>Category: </span>"+_42[0].Category+"</I><br>";if(_42[0].Medium!=""){_45+="<span style='color:rgb(56,64,142);'><I>Medium: </span>"+_42[0].Medium+"</I><br>";}if(_42[0].Dimensions!=""){_45+="<span style='color:rgb(56,64,142);'><I>Dimensions: </span>"+_42[0].Dimensions+"</I><br>";}if(_42[0].Year!=""){_45+="<span style='color:rgb(56,64,142);'><I>Year Created: </span>"+_42[0].Year+"</I><br>";}if(_42[0].Location2!=""){_45+="<span style='color:rgb(56,64,142);'><I>Location: </span>"+_42[0].Location2+"</I><br>";}if(_42[0].Agency!=""){_45+="<span style='color:rgb(56,64,142);'><I>Agency: </span>"+_42[0].Agency+"</I><br>";}_45+="<p>"+_42[0].Description+"</p>";_45+="</div>";myText="<html><HEAD><TITLE>Find Tacoma-Pierce County Public Art by Artist and Location - http://TacomaPierceCountyPublicArt.org</TITLE></HEAD><body>";myText+="<font face=verdana> <font size=-2><center><div style='width: 500px;background-color:#F7FCE1;padding:5px;margin-right: auto;margin-left: auto;text-align: left;'>";myText+="<div style='clear:both;width: 500px;'><hr color='#ACB1DB'></div>";myText+="<div style='width: 500px;background-color:#D1E9BC;padding:2px 0px 2px 0px;text-align:center;margin-right:auto;margin-left:auto;'><b>Tacoma-Pierce County Public Art Tour</b></div>";myText+="<div style='clear:both;width: 500px;'><hr color='#ACB1DB'></div>";myText+=_45;myText+="<img src='http://maps.google.com/maps/api/staticmap?center=";myText+=_42[0].Lat+","+_42[0].Long;myText+="&zoom=16&size=500x350&maptype=roadmap&markers=color:blue|label:A|";myText+=_42[0].Lat+","+_42[0].Long;myText+="&sensor=false' border=1></body></html>";myWindow=window.open("","","");myWindow.document.write(myText);myWindow.focus();};require(["dojo/parser","dijit/layout/BorderContainer","dijit/layout/TabContainer","dijit/layout/ContentPane","dijit/form/Form","dijit/form/Button","dijit/form/FilteringSelect","dojox/json/query","dojox/image/Lightbox","dijit/Dialog","dijit/TooltipDialog","dojo/dnd/Source","dojo/domReady!"],function(_46){_46.parse();initialize();getJson();dialog=new dojox.image.LightboxDialog().startup();dijit.byId("mapWelcome").show();});